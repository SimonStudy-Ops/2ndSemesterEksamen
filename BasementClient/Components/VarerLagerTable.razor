@using Core.Models

<table class="table table-striped">
    <thead>
        <tr>
            <th>Vare Navn</th>
            <th>Mængde</th>
            <th>Lokation</th>
            <th>Status</th>
            <th>Beholdningsstatus</th>
            <th>Handling</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var gruppe in GrupperedeVarer)   
    {
        var status = UdløbsStatusHelper.GetStatus(gruppe.Udløbsdato);
        var melding = UdløbsStatusHelper.GetMelding(gruppe.Udløbsdato);
        var rowClass = status != "ok" ? $"status-{status}" : "";
        
    
        <tr class="@rowClass">
            <td>@gruppe.VarerNavn</td>
            <td>@gruppe.TotalMængde</td>
            <td>@gruppe.Beholdninger.Count lokationer</td>
            <td>
                @if (! string.IsNullOrEmpty(melding))
                {
                    <span class="status-badge status-@status">@melding</span>
                }
                else
                {
                    <span style="color: green;">✓ OK</span>
                }
            </td>
            <td>
                @{
                    var bStatus = BeholdningsStatusHelper.GetStatus(gruppe.TotalMængde, gruppe.MinimumsBeholdning);
                    var bMelding = BeholdningsStatusHelper.GetMelding(gruppe.TotalMængde, gruppe.MinimumsBeholdning);
                }
                @if (! string.IsNullOrEmpty(bMelding))
                {
                    <span class="status-badge status-@bStatus">@bMelding</span>
                }
                else
                {
                    <span style="color: green;">✓ OK</span>
                }
            </td>
            <td>
                <button class="btn btn-info btn-sm" @onclick="() => OnDetailsClick.InvokeAsync(gruppe.VarerId)">
                    Se Detaljer
                </button>

                @if (IsAdmin)
                {
                    <button class="btn btn-warning btn-sm ms-2" @onclick="() => OnEditVareClick.InvokeAsync(gruppe.VarerId)">
                        Rediger Vare
                    </button>
                }
            </td>

            
        </tr>
    }
    </tbody>
</table>

@code {
    [Parameter]
    public IEnumerable<BasementClient.Pages.Varelager.GrupperetVare> GrupperedeVarer { get; set; } = Enumerable.Empty<BasementClient.Pages.Varelager.GrupperetVare>();

    [Parameter]
    public bool IsAdmin { get; set; }

    [Parameter]
    public EventCallback<int> OnDetailsClick { get; set; }

    [Parameter]
    public EventCallback<int> OnEditVareClick { get; set; }
}